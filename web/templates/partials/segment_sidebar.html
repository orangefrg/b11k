{{define "segment_sidebar"}}
<div class="side">
  <div class="control">
    <a class="link" href="/segments">&larr; Back to segments</a>
  </div>
  <h2 class="h">{{.Segment.Name}}</h2>
  {{if .Segment.Description}}
  <div class="stat">Description: <span class="muted">{{.Segment.Description}}</span></div>
  {{end}}
  <div class="stat">Created: <span class="muted">{{.Segment.CreatedAt}}</span></div>
  <div id="segment-metrics" class="stat" style="margin-top: 12px;">
    <div>Distance: <span class="muted" id="segment-distance">Loading...</span></div>
    <div>Elevation Gain: <span class="muted" id="segment-elevation">Loading...</span></div>
  </div>
  
  <div class="control" style="margin-top: 20px;">
    <label for="tolerance">Tolerance (meters):</label>
    <input type="number" id="tolerance" value="15" min="1" max="100" step="1" style="width: 80px; padding: 4px;" />
    <button id="find-activities-btn" type="button" style="margin-left: 12px;">Find Activities</button>
    <button id="refresh-cache-btn" type="button" style="margin-left: 8px;">Refresh Cache</button>
  </div>

  <div id="activities-loading" style="display:none; margin: 12px 0; color: var(--text);">Loading activities...</div>
  
  <div id="activities-section" style="display:none;">
    <div class="control" style="margin-top: 12px;">
      <label for="sort-by">Sort by:</label>
      <select id="sort-by">
        <option value="distance">Best Match</option>
        <option value="avg_hr">Avg HR</option>
        <option value="avg_speed">Avg Speed</option>
        <option value="total_time">Total Time</option>
        <option value="date">Activity Date</option>
      </select>
    </div>
    
    <div id="activities-list" style="margin-top: 12px; max-height: 400px; overflow-y: auto;">
      <!-- Activities will be populated here -->
    </div>
  </div>

  <div class="control" style="margin-top: 20px;">
    <label for="color-metric">Color points by:</label>
    <select id="color-metric">
      <option value="none">None</option>
      <option value="speed">Speed</option>
      <option value="heartrate">Heart rate</option>
      <option value="hrzones">HR zones</option>
      <option value="alt">Altitude</option>
      <option value="grade">Slope</option>
      <option value="moving">Stops</option>
      <option value="cadence">Cadence</option>
    </select>
  </div>
  <div class="control" style="margin-top: 12px; margin-bottom: 20px; position: relative;">
    <div id="legend" class="legend vertical" style="display:none; position: relative; z-index: 1;"></div>
  </div>
</div>
{{end}}

